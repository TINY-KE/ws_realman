<?xml version="1.0" encoding="utf-8"?>
<robot name="rm_65" xmlns:xacro="http://www.ros.org/wiki/xacro">
<xacro:include filename="$(find rm_65_description)/urdf/rm_65.transmission.xacro"/>
<xacro:include filename="$(find rm_65_description)/urdf/rm_65.gazebo.xacro"/>

<!-- =========================== 添加虚拟根链接解决KDL问题 =========================== -->

<!-- 修改原来的base_link_wheeltec惯性参数 -->
<link name="base_link_wheeltec">
  <!-- 减小惯性参数以避免KDL警告 -->
  <inertial>
    <origin xyz="0 0 0.0975" rpy="0 0 0"/>
    <mass value="0.1"/>  <!-- 减小质量 -->
    <inertia
      ixx="0.001"
      ixy="0.0"
      ixz="0.0"
      iyy="0.001"
      iyz="0.0"
      izz="0.001"/>
  </inertial>
  <!-- <visual>
    <origin xyz="0 0 0.0975" rpy="0 0 0" />
    <geometry>
      <box size="0.27 0.185 0.055"/>
    </geometry>
    <material name="white">
      <color rgba="1 1 1 1"/>
    </material>
  </visual> -->
   <visual>
      <origin xyz="0 0 0.17" rpy="0 0 0" />  <!-- 高度中心：13cm/2=6.5cm -->
      <geometry>
          <box size="0.5 0.4 0.3"/>  <!-- 长×宽×高：50cm×40cm×13cm -->
      </geometry>
      <material name="white">
          <color rgba="1 1 0 1"/>
      </material>
  </visual>
  <collision>
    <origin xyz="0 0 0.0975" rpy="0 0 0" />
    <geometry>
      <box size="0.27 0.185 0.055"/>
    </geometry>
  </collision>
</link>


<!-- 添加Gazebo物理属性 -->
<gazebo reference="base_link_wheeltec">
  <mu1 value="0.5"/>
  <mu2 value="0.5"/>
  <kp value="1000000.0"/>
  <kd value="100.0"/>
</gazebo>

<!-- =========================== Wheeltec Mobile Base =========================== -->
<!-- 修改轮子关节类型：continuous -> revolute -->
<!-- 前左轮 -->
<joint name="left_front_joint" type="revolute">
  <origin xyz="0.191 0.202  0.0375" rpy="1.57 0 0"/>
  <parent link="base_link_wheeltec"/>
  <child link="left_front_link"/>
  <axis xyz="0 1 0"/>
  <limit lower="-100" upper="100" effort="10" velocity="10"/>
</joint>

<link name="left_front_link">
  <inertial>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <mass value="0.5"/>
    <inertia
      ixx="0.0005"
      ixy="0.0"
      ixz="0.0"
      iyy="0.001"
      iyz="0.0"
      izz="0.0005"/>
  </inertial>
  <visual>
    <origin xyz="0 0 0" rpy="0 0 0" />
    <geometry>
      <cylinder radius="0.0375" length="0.03"/>
    </geometry>
    <material name="black">
      <color rgba="0 0 0 1"/>
    </material>
  </visual>
  <collision>
    <origin xyz="0 0 0" rpy="0 0 0" />
    <geometry>
      <cylinder radius="0.0375" length="0.03"/>
    </geometry>
  </collision>
</link>

<!-- 前右轮 -->
<joint name="right_front_joint" type="revolute">
  <origin xyz="0.191 -0.202  0.0375" rpy="1.57 0 0"/>
  <parent link="base_link_wheeltec"/>
  <child link="right_front_link"/>
  <axis xyz="0 1 0"/>
  <limit lower="-100" upper="100" effort="10" velocity="10"/>
</joint>

<link name="right_front_link">
  <inertial>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <mass value="0.5"/>
    <inertia
      ixx="0.0005"
      ixy="0.0"
      ixz="0.0"
      iyy="0.001"
      iyz="0.0"
      izz="0.0005"/>
  </inertial>
  <visual>
    <origin xyz="0 0 0" rpy="0 0 0" />
    <geometry>
      <cylinder radius="0.0375" length="0.03"/>
    </geometry>
    <material name="black">
      <color rgba="0 0 0 1"/>
    </material>
  </visual>
  <collision>
    <origin xyz="0 0 0" rpy="0 0 0" />
    <geometry>
      <cylinder radius="0.0375" length="0.03"/>
    </geometry>
  </collision>
</link>

<!-- 后左轮 -->
<joint name="left_wheel_joint" type="revolute">
  <origin xyz="-0.191 0.202  0.0375" rpy="1.57 0 0"/>
  <parent link="base_link_wheeltec"/>
  <child link="left_wheel_link"/>
  <axis xyz="0 1 0"/>
  <limit lower="-100" upper="100" effort="10" velocity="10"/>
</joint>

<link name="left_wheel_link">
  <inertial>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <mass value="0.5"/>
    <inertia
      ixx="0.0005"
      ixy="0.0"
      ixz="0.0"
      iyy="0.001"
      iyz="0.0"
      izz="0.0005"/>
  </inertial>
  <visual>
    <origin xyz="0 0 0" rpy="0 0 0" />
    <geometry>
      <cylinder radius="0.0375" length="0.03"/>
    </geometry>
    <material name="black">
      <color rgba="0 0 0 1"/>
    </material>
  </visual>
  <collision>
    <origin xyz="0 0 0" rpy="0 0 0" />
    <geometry>
      <cylinder radius="0.0375" length="0.03"/>
    </geometry>
  </collision>
</link>

<!-- 后右轮 -->
<joint name="right_wheel_joint" type="revolute">
  <origin xyz="-0.191 -0.202  0.0375" rpy="1.57 0 0"/>
  <parent link="base_link_wheeltec"/>
  <child link="right_wheel_link"/>
  <axis xyz="0 1 0"/>
  <limit lower="-100" upper="100" effort="10" velocity="10"/>
</joint>

<link name="right_wheel_link">
  <inertial>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <mass value="0.5"/>
    <inertia
      ixx="0.0005"
      ixy="0.0"
      ixz="0.0"
      iyy="0.001"
      iyz="0.0"
      izz="0.0005"/>
  </inertial>
  <visual>
    <origin xyz="0 0 0" rpy="0 0 0" />
    <geometry>
      <cylinder radius="0.0375" length="0.03"/>
    </geometry>
    <material name="black">
      <color rgba="0 0 0 1"/>
    </material>
  </visual>
  <collision>
    <origin xyz="0 0 0" rpy="0 0 0" />
    <geometry>
      <cylinder radius="0.0375" length="0.03"/>
    </geometry>
  </collision>
</link>

<!-- 为轮子添加Gazebo插件 -->
<gazebo reference="left_front_link">
  <mu1 value="1.0"/>
  <mu2 value="1.0"/>
</gazebo>
<gazebo reference="right_front_link">
  <mu1 value="1.0"/>
  <mu2 value="1.0"/>
</gazebo>
<gazebo reference="left_wheel_link">
  <mu1 value="1.0"/>
  <mu2 value="1.0"/>
</gazebo>
<gazebo reference="right_wheel_link">
  <mu1 value="1.0"/>
  <mu2 value="1.0"/>
</gazebo>

<!-- =========================== RM-65 Arm Base =========================== -->
<joint name="wheeltec_to_arm_joint" type="fixed">
  <origin xyz="0 0 0.34" rpy="0 0 3.1415926"/>
  <parent link="base_link_wheeltec"/>
  <child link="base_link"/>
</joint>

<!-- RM-65机械臂的base_link -->
<link name="base_link">
  <inertial>
    <origin
      xyz="-0.000433277303987328 -3.54664423471128E-05 0.0599427668933796"
      rpy="0 0 0" />
    <mass
      value="0.841070778135659" />
    <inertia
      ixx="0.0017261110801622"
      ixy="2.52746264980217E-06"
      ixz="-3.67690303614961E-05"
      iyy="0.00170987405835604"
      iyz="1.67996364994424E-06"
      izz="0.000904023422915791" />
  </inertial>
  <visual>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/base_link.STL" />
    </geometry>
    <material
      name="">
      <color
        rgba="1 1 1 1" />
    </material>
  </visual>
  <collision>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/base_link.STL" />
    </geometry>
  </collision>
</link>

<gazebo reference="base_link">
  <mu1 value="200000.0"/>
  <mu2 value="200000.0"/>
  <kp value="100000000.0"/>
  <kd value="1.0"/>
</gazebo>

<!-- =========================== RM-65 Arm Links and Joints =========================== -->
<!-- 保持原有机械臂部分不变 -->
<link
  name="Link1">
  <inertial>
    <origin
      xyz="1.2226305431569E-08 0.0211079974844683 -0.0251854220842269"
      rpy="0 0 0" />
    <mass
      value="0.593563443690403" />
    <inertia
      ixx="0.00126614120341847"
      ixy="-1.294980943835E-08"
      ixz="-9.80120923066996E-09"
      iyy="0.00118168178300364"
      iyz="-0.00021121727444415"
      izz="0.00056135241627747" />
  </inertial>
  <visual>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link1.STL" />
    </geometry>
    <material
      name="">
      <color
        rgba="1 1 1 1" />
    </material>
  </visual>
  <collision>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link1.STL" />
    </geometry>
  </collision>
</link>
<joint
  name="joint1"
  type="revolute">
  <origin
    xyz="0 0 0.2405"
    rpy="0 0 0" />
  <parent
    link="base_link" />
  <child
    link="Link1" />
  <axis
    xyz="0 0 1" />
  <limit
    lower="-3.1"
    upper="3.1"
    effort="60"
    velocity="3.14" />
	<dynamics damping="50" friction="1"/>
</joint>

<link
  name="Link2">
  <inertial>
    <origin
      xyz="0.152256463426163 4.75383656106654E-07 -0.00620260383607792"
      rpy="0 0 0" />
    <mass
      value="0.864175046869043" />
    <inertia
      ixx="0.00089150298478414"
      ixy="-2.23268489334765E-08"
      ixz="0.00156246461035015"
      iyy="0.00733754343083901"
      iyz="6.28110889329165E-09"
      izz="0.00697869103915473" />
  </inertial>
  <visual>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link2.STL" />
    </geometry>
    <material
      name="">
      <color
        rgba="1 1 1 1" />
    </material>
  </visual>
  <collision>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link2.STL" />
    </geometry>
  </collision>
</link>
<joint
  name="joint2"
  type="revolute">
  <origin
    xyz="0 0 0"
    rpy="1.5708 -1.5708 0" />
  <parent
    link="Link1" />
  <child
    link="Link2" />
  <axis
    xyz="0 0 1" />
  <limit
    lower="-2.268"
    upper="2.268"
    effort="60"
    velocity="3.14" />
	<dynamics damping="50" friction="1"/>
</joint>

<link
  name="Link3">
  <inertial>
    <origin
      xyz="5.05312670989961E-06 -0.0595925663694732 0.010569069212336"
      rpy="0 0 0" />
    <mass
      value="0.289633681624654" />
    <inertia
      ixx="0.00063737100450158"
      ixy="-7.05261293649751E-08"
      ixz="-3.86643272239426E-08"
      iyy="0.00015648388095025"
      iyz="-0.00014461035994916"
      izz="0.000614178164773085" />
  </inertial>
  <visual>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link3.STL" />
    </geometry>
    <material
      name="">
      <color
        rgba="1 1 1 1" />
    </material>
  </visual>
  <collision>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link3.STL" />
    </geometry>
  </collision>
</link>
<joint
  name="joint3"
  type="revolute">
  <origin
    xyz="0.256 0 0"
    rpy="0 0 1.5708" />
  <parent
    link="Link2" />
  <child
    link="Link3" />
  <axis
    xyz="0 0 1" />
  <limit
    lower="-2.355"
    upper="2.355"
    effort="30"
    velocity="3.92" />
	<dynamics damping="50" friction="1"/>
</joint>

<link
  name="Link4">
  <inertial>
    <origin
      xyz="1.15516617405898E-06 -0.0180424468598241 -0.0215394748352687"
      rpy="0 0 0" />
    <mass
      value="0.239419768320061" />
    <inertia
      ixx="0.000285938919722783"
      ixy="3.07101359163101E-09"
      ixz="-2.21994118981953E-09"
      iyy="0.000262727540304212"
      iyz="4.4236583260078E-05"
      izz="0.000119888082791859" />
  </inertial>
  <visual>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link4.STL" />
    </geometry>
    <material
      name="">
      <color
        rgba="1 1 1 1" />
    </material>
  </visual>
  <collision>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link4.STL" />
    </geometry>
  </collision>
</link>
<joint
  name="joint4"
  type="revolute">
  <origin
    xyz="0 -0.21 0"
    rpy="1.5708 0 0" />
  <parent
    link="Link3" />
  <child
    link="Link4" />
  <axis
    xyz="0 0 1" />
  <limit
    lower="-3.1"
    upper="3.1"
    effort="10"
    velocity="3.92" />
	<dynamics damping="50" friction="1"/>
</joint>

<link
  name="Link5">
  <inertial>
    <origin
      xyz="3.19794786262152E-06 -0.0593808368101458 0.00736804250989326"
      rpy="0 0 0" />
    <mass
      value="0.218799761431678" />
    <inertia
      ixx="0.000350540363914072"
      ixy="-3.41781619975602E-08"
      ixz="-1.77056457224373E-08"
      iyy="0.000104927867487581"
      iyz="-7.82431228461971E-05"
      izz="0.000334482418423629" />
  </inertial>
  <visual>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link5.STL" />
    </geometry>
    <material
      name="">
      <color
        rgba="1 1 1 1" />
    </material>
  </visual>
  <collision>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link5.STL" />
    </geometry>
  </collision>
</link>
<joint
  name="joint5"
  type="revolute">
  <origin
    xyz="0 0 0"
    rpy="-1.5708 0 0" />
  <parent
    link="Link4" />
  <child
    link="Link5" />
  <axis
    xyz="0 0 1" />
  <limit
    lower="-2.233"
    upper="2.233"
    effort="10"
    velocity="3.92" />
	<dynamics damping="50" friction="1"/>
</joint>

<link
  name="Link6">
  <inertial>
    <origin
      xyz="0.000714234511756999 -0.000396718732824521 -0.0126723660946126"
      rpy="0 0 0" />
    <mass
      value="0.0649018034311231" />
    <inertia
      ixx="2.02766547502765E-05"
      ixy="-1.32505200276849E-06"
      ixz="-2.5845091522508E-08"
      iyy="1.87986725225022E-05"
      iyz="3.39471452125439E-09"
      izz="3.17885459163081E-05" />
  </inertial>
  <visual>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link6.STL" />
    </geometry>
    <material
      name="">
      <color
        rgba="1 1 1 1" />
    </material>
  </visual>
  <collision>
    <origin
      xyz="0 0 0"
      rpy="0 0 0" />
    <geometry>
      <mesh
        filename="package://rm_65_description/meshes/link6.STL" />
    </geometry>
  </collision>
</link>
<joint
  name="joint6"
  type="revolute">
  <origin
    xyz="0 -0.144 0"
    rpy="1.5708 0 0" />
  <parent
    link="Link5" />
  <child
    link="Link6" />
  <axis
    xyz="0 0 1" />
  <limit
    lower="-6.28"
    upper="6.28"
    effort="10"
    velocity="3.92" />
	<dynamics damping="50" friction="1"/>
</joint>

<!-- =========================== Transmission and Control =========================== -->
<!-- Transmissions for ROS Control -->
<xacro:macro name="transmission_block" params="joint_name">
  <transmission name="tran1">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="${joint_name}">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor1">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
</xacro:macro>
  
<xacro:transmission_block joint_name="joint1"/>
<xacro:transmission_block joint_name="joint2"/>
<xacro:transmission_block joint_name="joint3"/>
<xacro:transmission_block joint_name="joint4"/>
<xacro:transmission_block joint_name="joint5"/>
<xacro:transmission_block joint_name="joint6"/>

<!-- 为移动底座添加传输 -->
<xacro:transmission_block joint_name="left_front_joint"/>
<xacro:transmission_block joint_name="right_front_joint"/>
<xacro:transmission_block joint_name="left_wheel_joint"/>
<xacro:transmission_block joint_name="right_wheel_joint"/>

<!-- ros_control plugin -->
<gazebo>
  <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
    <robotNamespace>/arm</robotNamespace>
    <robotSimType>gazebo_ros_control/DefaultRobotHWSim</robotSimType>
    <legacyModeNS>true</legacyModeNS>
  </plugin>
</gazebo>
</robot>